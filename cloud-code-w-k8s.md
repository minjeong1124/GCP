## ì™œ í•˜ëŠ”ê°€?

1. ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ê°œë°œí•˜ëŠ” IDEì— í†µí•© ë˜ê¸° ë•Œë¬¸ì—,  ì½”ë“œ ê°œë°œê³¼ k8s í™˜ê²½ êµ¬ì„±ì„ í•¨ê»˜ í•  ìˆ˜ ìˆê³ , ì‹¤í–‰ ë° ë””ë²„ê¹…, ë¡œê·¸ í™•ì¸ê¹Œì§€ ê°€ëŠ¥.

- ë¡œì»¬ ë°°í¬ ê°„ì†Œí™” (launch) 
SkaffoId, Kubectl ë“± ë„êµ¬ë¥¼ í†µí•´ IDEì—ì„œ ë°”ë¡œ ì½”ë“œ í”¼ë“œë°± ë³¼ ìˆ˜ ìˆìŒ, ì¥ì ì´ì ë‹¨ì .. risk ìœ 
- ì‹¤í–‰ ì¤‘ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ë””ë²„ê·¸ (attach) 
ê¸°ë³¸ ì œê³µë˜ëŠ” IDE ë””ë²„ê¹… ê¸°ëŠ¥ì„ í™œìš©í•´ IDEì—ì„œ ì½”ë“œ ë””ë²„ê·¸ ê°€ëŠ¥

2. skaffoldì™€ í†µí•©ë˜ì–´ ë¹Œë“œ/ë°°í¬ íŒŒì´í”„ë¼ì¸ì˜ ì‘ì„± ë° ì‹¤í–‰ì´ ê°€ëŠ¥.

3. Skaffold ì™€ Kubernetes ì„¤ì • íŒŒì¼(yaml) ì‘ì„± ì‹œ, ê¸°ë³¸ í…œí”Œë¦¿ ì œê³µ ë° í‚¤ì›Œë“œ ìë™ ì™„ì„± ì§€ì›í•˜ì—¬, ì„¤ì • íŒŒì¼ë“¤ì„ ì‰½ê²Œ ì‘ì„±í•  ìˆ˜ ìˆìŒ

4. ê°„í¸í•œ Google Cloud API í†µí•©
IDEì—ì„œ Google Cloud API ì°¾ì•„ ì¶”ê°€ ë° êµ¬ì„±í•˜ê³  ê´€ë ¨ ë¬¸ì„œ ì‰½ê²Œ ì—´ëŒ ê°€ëŠ¥
ìš°ì¸¡ ë°”ì— Google Cloud Storage íƒ­ : ë²„í‚·, í´ë”, ë¸”ë ëª¨ë‘ ë³¼ ìˆ˜ ìˆìŒ 
ìš°ì¸¡ ë°” Kubernetes Explorer íƒ­ : í´ëŸ¬ìŠ¤í„° ë¦¬ì†ŒìŠ¤ë“¤ì˜ ì •ë³´ í™•ì¸, ë¡œê·¸ ë·°ì–´ ë° í„°ë¯¸ë„ ì°½

**â‡’ ìœ„ ì¥ì ë“¤ì„ í†µí•´ í”„ë¡œì íŠ¸ì— ì ìš© ì—¬ë¶€ í…ŒìŠ¤íŠ¸**

## ì–´ë–»ê²Œ í•  ê²ƒì¸ê°€?

ì´ë¡  íŒŒì•… â†’ ê°œì¸ ê³„ì •ìœ¼ë¡œ í´ëŸ¬ìŠ¤í„° ìƒì„± ë° í´ë¼ìš°ë“œ ì½”ë“œ ì ìš© â†’ í˜„ì¬ neart í”„ë¡œì íŠ¸ì— í´ë¼ìš°ë“œ ì½”ë“œ ì ìš©

## ìŠ¤í„°ë””í•œ ê²°ê³¼

- Cloud Code 
GCPì˜ k8s or cloud run ê¸°ë°˜ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œ ë„êµ¬ë¡œ, Intellijë‚˜ VS ê°™ì€ IDE(í†µí•© ê°œë°œ í™˜ê²½)ì— í”ŒëŸ¬ê·¸ì¸ ë°©ì‹ìœ¼ë¡œ ì—°ê²°í•´ì„œ ì‚¬ìš©.
- ì„¤ì¹˜ 
[https://cloud.google.com/code/docs/intellij/install](https://cloud.google.com/code/docs/intellij/install)

- ìƒ˜í”Œ í”„ë¡œì íŠ¸ ì ìš© ë°©ë²•
[https://cloud.google.com/code/docs/intellij/creating-a-k8-app](https://cloud.google.com/code/docs/intellij/creating-a-k8-app)

- ë°°í¬
- '`Run on Kubernetes`' ì‹¤í–‰ ì‘ì—… ì•„ì´ì½˜ìœ¼ë¡œ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ê³  í”„ë¡œì íŠ¸ë¥¼ Kubernetes í´ëŸ¬ìŠ¤í„°ì— ë°°í¬
- '`Develop on Kubernetes`' ì‹¤í–‰ ì‘ì—… ì•„ì´ì½˜ìœ¼ë¡œ Kubernetes í´ëŸ¬ìŠ¤í„°ì—ì„œ ê°œë°œ ì£¼ê¸°ë¥¼ ì‹œì‘
ê°œë°œ ì£¼ê¸°ê°€ ì‹œì‘ë˜ë©´ Cloud Codeê°€ Skaffoldë¥¼ ì‚¬ìš©í•˜ì—¬ í”„ë¡œì íŠ¸ì˜ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•œ ë‹¤ìŒ íƒœê·¸ë¥¼ ì§€ì •í•˜ê³  êµ¬ì„±ëœ ì €ì¥ì†Œì— ì´ë¥¼ í‘¸ì‹œí•œ í›„, kubectlì„ ì‚¬ìš©í•˜ì—¬ í”„ë¡œì íŠ¸ Kubernetes ë§¤ë‹ˆí˜ìŠ¤íŠ¸ë¥¼ ë°°í¬

- ì‚½ì§ˆ story ,, ì£¼ì˜ì‚¬í•­ ******ğŸš¨
******
    1. ê°œì¸ ê³„ì •ê³¼ íšŒì‚¬ ê³„ì • ì¶©ëŒ ì‹œ

    - `gcloud init` 
    â†’ ì›í•˜ëŠ” ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ 
    â†’ `gcloud container clusters get-credentials í´ëŸ¬ìŠ¤í„° ì •ë³´`

    - IDE ìš°ì¶• íˆ´ ë°” Kubernetes Explorerì—ì„œ ê°œì¸ ê³„ì • í”„ë¡œì íŠ¸ì˜ í´ëŸ¬ìŠ¤í„°ë¡œ ì „í™˜í•´ë„ ë˜ì§€ë§Œ (ëœë‹¤ê³  ë‚˜ì™€ìˆì§€ë§Œ ì–´ë–¤ ì´ìœ ì—ì„œì¸ì§€ í„°ë¯¸ë„ë¡œ í™•ì¸í•´ë³´ë‹ˆ ë˜ì§€ ì•Šì•˜ìŒ) 
     [k8s ëª…ë ¹ì–´ kubectl ì„¤ì¹˜ ë°©ë²•](https://kubernetes.io/ko/docs/tasks/tools/install-kubectl/#macos%EC%97%90%EC%84%9C-curl%EC%9D%84-%EC%82%AC%EC%9A%A9%ED%95%98%EC%97%AC-kubectl-%EB%B0%94%EC%9D%B4%EB%84%88%EB%A6%AC-%EC%84%A4%EC%B9%98) 
    í„°ë¯¸ë„ì—ì„œ kubectl ì„¤ì¹˜ í›„ `kubectl config view` í•´ ë³¸ í›„ current contextê°€ ì „í™˜ë˜ì–´ ìˆì§€ ì•Šë‹¤ë©´, ë‹¤ì‹œ `kubectl config use-context í´ëŸ¬ìŠ¤í„° ì •ë³´` ë¡œ cluster switch

    2. ì´ë¯¸ì§€ ì €ì¥ì†Œ ì…ë ¥ ì‹œ `{project-name}` ì´ ì•„ë‹Œ `{project-id}` ë¡œ ì…ë ¥ í•  ê²ƒ.
    í”„ë¡œì íŠ¸ ì´ë¦„ì´ë¼ê³  ë¬¸ì„œì— ë˜ì–´ ìˆì—ˆìœ¼ë‚˜ ê³„ì† ì €ì¥ì†Œë¥¼ ì°¾ì§€ ëª»í•˜ì—¬ id ì…ë ¥í•˜ë‹ˆ ë¨ ..

        ![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/b4a31558-4b5a-48a8-98ba-4f663b4f8bee/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/b4a31558-4b5a-48a8-98ba-4f663b4f8bee/Untitled.png)

    3. cloud code í”ŒëŸ¬ê·¸ì¸ì„ í”„ë¡œì íŠ¸ì— ì‚¬ìš©í•˜ë ¤ë©´ ì¶”ê°€ êµ¬ì„± í•„ìš”. ì¶”ê°€ êµ¬ì„±ìœ¼ë¡œëŠ” ìë™ìœ¼ë¡œ ìƒì„±ë˜ê±°ë‚˜ ì œê³µëœ í…œí”Œë¦¿ìœ¼ë¡œ ë§Œë“¤ ìˆ˜ ìˆëŠ” Skaffold YAML íŒŒì¼ í•„ìš”. ([yaml ë¬¸ë²•](https://lejewk.github.io/yaml-syntax/))
    Dockerfileì´ ìˆëŠ” í”„ë¡œì íŠ¸ì˜ ê²½ìš°, ë¬¸ì„œì— ë‚˜ì™€ìˆëŠ” ëŒ€ë¡œ Tools â†’ Cloud Code â†’ Kubernetes â†’ add Kubernetes supportë¥¼ í•˜ë©´ ì¶”ê°€ êµ¬ì„±ì´ ìë™ìœ¼ë¡œ ì´ë£¨ì–´ì§€ì§€ë§Œ, 
    í˜„ì¬ neart í”„ë¡œì íŠ¸ëŠ” ë©€í‹° ëª¨ë“ˆë¡œ ë˜ì–´ ìˆì–´ Dockerfileì´ rootê°€ ì•„ë‹Œ ëª¨ë“ˆ ë³„ë¡œ ë˜ì–´ ìˆìŒë˜ì§€ ì•ŠìŒ .. (rootì— ìˆì–´ì•¼ ì¸ì‹ í•˜ë‚˜ ë´„) â‡’ ì–´ì©” ìˆ˜ ì—†ì´ ìˆ˜ë™ìœ¼ë¡œ skaffold.yaml íŒŒì¼ ìƒì„±

â‡’ skaffold ì„¤ì¹˜

`curl -Lo skaffold[https://storage.googleapis.com/skaffold/releases/v1.13.2/skaffold-darwin-amd64](https://storage.googleapis.com/skaffold/releases/v1.13.2/skaffold-darwin-amd64) && chmod +x skaffold && sudo mv skaffold /usr/local/bin`

â‡’ í”„ë¡œì íŠ¸ root ë””ë ‰í„°ë¦¬ì— `skaffold.yaml` ìˆ˜ë™ ë§Œë“¤ê¸°
ì°¸ê³  : [https://skaffold-latest.firebaseapp.com/docs/references/yaml/](https://skaffold-latest.firebaseapp.com/docs/references/yaml/)

```jsx
apiVersion: skaffold/v2alpha2
kind: Config
metadata:
  name: nearart-end-user-server
build:
  artifacts:
    - image: nearart-end-user-server
      docker:
        dockerfile: end-user/Dockerfile
        noCache: false
deploy:
  helm:
    releases:
      - name: nearart-end-user-server
        chartPath: end-user/charts/chart
        setValues:
          image.repository: nearart-end-user-server
```

í–ˆë”ë‹ˆ 

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/8960dcf0-a35f-471b-aa70-533709a43bfa/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/8960dcf0-a35f-471b-aa70-533709a43bfa/Untitled.png)

í”„ë¡œì íŠ¸ì— ì ìš© ë¨. 
í•˜ì§€ë§Œ ë­”ê°€ ì„¤ì •ì´ ì˜ëª»ë¼ì„œ ì‚½ì§ˆ ì¤‘ .. 

```jsx
Listing files to watch...
 - nearart-end-user-server
watching files for artifact "nearart-end-user-server": listing files: file pattern [target/end-user-0.0.1.jar] must match at least one file
```

dockerfile ì¸ì‹ì€ í•˜ë‚˜ ê²½ë¡œ ë° íŒŒì¼ ì°¾ì§€ ëª»í•´ ìˆ˜ì • í•„ìš”
â‡’ ë‹¤ë‹¨ê³„ ë¹Œë“œ ë°©ë²• ì‚¬ìš© (AS builder, COPY â€”from=builder)

```jsx
FROM openjdk:8-jdk-slim AS builder
ENV PORT 8080
'
'
'
'
'
COPY --from=builder . /opt/app.jar
'
'
'
```

[https://github.com/docker/cli/issues/1559](https://github.com/docker/cli/issues/1559)
â‡’ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì™„ë£Œ 

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/7d57a9ef-0a2c-4df4-8411-83251547b886/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/7d57a9ef-0a2c-4df4-8411-83251547b886/Untitled.png)

â‡’ but, helm ë°°í¬ ì‹¤íŒ¨ (helm ì„¤ì¹˜ ì•ˆë˜ì–´ ìˆì–´ì„œ helm command failed)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/6b2a988b-7cbd-4b7a-a53f-e16c0c1f032a/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/6b2a988b-7cbd-4b7a-a53f-e16c0c1f032a/Untitled.png)

```jsx
time="2020-09-03T00:31:14+09:00" level=warning msg="deployer cleanup: failed to determine binary version: helm version command failed \"\": exec: \"helm\": executable file not found in $PATH"
exiting dev mode because first deploy failed: failed to determine binary version: helm version command failed "": exec: "helm": executable file not found in $PATH
```

â‡’ helm ì„¤ì¹˜`brew install helm`
but, ë˜ ë‹¤ë¥¸ ë¬¸ì œì— ì§ë©´ .. ..

```jsx
coalesce.go:196: warning: cannot overwrite table with non table for repository (map[REPOSITORY:<nil>])
Error: UPGRADE FAILED: failed to create resource: Service "map[NAME:<nil>]" is invalid: [metadata.name: Invalid value: "map[NAME:<nil>]": a DNS-1035 label must consist of lower case alphanumeric characters or '-', start with an alphabetic character, and end with an alphanumeric character (e.g. 'my-name',  or 'abc-123', regex used for validation is '[a-z]([-a-z0-9]*[a-z0-9])?'), spec.selector: Invalid value: "map[NAME:<nil>]": a valid label must be an empty string or consist of alphanumeric characters, '-', '_' or '.', and must start and end with an alphanumeric character (e.g. 'MyValue',  or 'my_value',  or '12345', regex used for validation is '(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])?')]
exiting dev mode because first deploy failed: deploying "nearart-end-user-server": install: exit status 1
```

â‡’ 

<additional>

- Skaffold 
****k8s ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë¹Œë“œ/ë°°í¬ ê´€ë ¨ íŒŒì´í”„ë¼ì¸ì„ ì •ì˜í•˜ê³  ì‹¤í–‰í•˜ëŠ” ë„êµ¬
ë°˜ë³µì ì¸ ë¹Œë“œ/ë°°í¬ íŒŒì´í”„ë¼ì¸ì˜ ìë™í™”ë¥¼ ì œê³µí•˜ì—¬ ê°œë°œìê°€ ê°œë°œì— ë”ìš± ì§‘ì¤‘ í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤Œ
ê´€ë ¨ ìƒì„¸ ì •ë³´ë“¤ì„ ì„¤ì •íŒŒì¼ skaffold.yaml ë¡œ ì •ì˜
skaffoldë¥¼ ê°œë°œ í™˜ê²½ì—ì„œ ì‹¤í–‰ í•˜ë©´ ì†ŒìŠ¤ ì½”ë“œì˜ ë³€ê²½ì„ ê°ì‹œí•˜ê³ , ì†ŒìŠ¤ ì½”ë“œì˜ ë³€ê²½ì´ ê°ì§€ë˜ë©´ ìë™ìœ¼ë¡œ ì„¤ì •ëœ íŒŒì´í”„ë¼ì¸ì„ ì‹¤í–‰í•˜ì—¬ ë¹Œë“œ/ë°°í¬ ìˆ˜í–‰
1. ì†ŒìŠ¤ ì½”ë“œ ë³€ê²½ ì£¼ê¸°ì ìœ¼ë¡œ ê°ì‹œ
2. ì†ŒìŠ¤ ì½”ë“œ ê¸°ë°˜ìœ¼ë¡œ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ë¹Œë“œ (Docker)
3. ë¹Œë“œ ëœ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ì˜ ìœ íš¨ì„± í…ŒìŠ¤íŠ¸
4. ë¹Œë“œ ëœ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ì— íƒœê¹… 
5. íƒœê¹… ëœ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ì €ì¥ì†Œì— ì €ì¥ (push)
6. k8s í´ëŸ¬ìŠ¤í„°ì— ë°°í¬ 
skaffoldì˜ ì‹¤í–‰ì€ skaffold.yamlì´ ìˆëŠ” ê²½ë¡œì—ì„œ ëª…ë ¹ì–´ë¥¼ í†µí•´ ì‹¤í–‰ í•  ìˆ˜ ìˆìŒ
`skaffold dev` : ì†ŒìŠ¤ ì½”ë“œì˜ ë³€ê²½ì´ ë°œìƒí•˜ëŠ” ì§€ë¥¼ ê°ì‹œí•˜ê³ , ì†ŒìŠ¤ ì½”ë“œ ë³€ê²½ ë°œìƒ ì‹œ ì •ì˜ í•´ë†“ì€ íŒŒì´í”„ë¼ì¸ì„ ìë™ìœ¼ë¡œ ì‹¤í–‰ 
â‡’ intellij "Develop on Kubernetes"
`skaffold run` : ì •ì˜ í•´ë†“ì€ íŒŒì´í”„ë¼ì¸ì„ ì¼íšŒì„±ìœ¼ë¡œ ì‹¤í–‰
â‡’ intellij "Run on Kubernetes"
- Helm 
k8s ë¥¼ packageë¡œ ê´€ë¦¬ í•´ì£¼ëŠ” package manager (Node.jsì˜ npm ì—­í• )
helm chart : helmì˜ package format, k8së¥¼ ì„¤ëª…í•˜ëŠ” íŒŒì¼ë“¤ì˜ ì§‘í•©

## ìŠ¤í„°ë””ì— ì°¸ì¡°í•œ ë¬¸ì„œ

[https://cloud.google.com/code](https://cloud.google.com/code)
[https://gc.hosting.kr/blog-msa_googlecloudcode-2/](https://gc.hosting.kr/blog-msa_googlecloudcode-2/)
[https://cloud.google.com/code/docs/intellij/using-a-k8-existing-app](https://cloud.google.com/code/docs/intellij/using-a-k8-existing-app)
[https://medium.com/google-cloud-apac/gcp-skaffold-ê·¸ë¦¬ê³ -cloud-code-65aad64ba782](https://medium.com/google-cloud-apac/gcp-skaffold-%EA%B7%B8%EB%A6%AC%EA%B3%A0-cloud-code-65aad64ba782)
[https://cloud.google.com/code/docs?hl=ko#ê¸°ëŠ¥](https://cloud.google.com/code/docs?hl=ko#%EA%B8%B0%EB%8A%A5)
[https://www.youtube.com/watch?v=geGzJSI_SPs](https://www.youtube.com/watch?v=geGzJSI_SPs)
[https://github.com/GoogleContainerTools/jib/tree/master/jib-maven-plugin#setup](https://github.com/GoogleContainerTools/jib/tree/master/jib-maven-plugin#setup)
[https://skaffold.dev/docs/references/yaml/](https://skaffold.dev/docs/references/yaml/)
[https://github.com/GoogleContainerTools/skaffold/blob/master/examples/jib-multimodule/pom.xml](https://github.com/GoogleContainerTools/skaffold/blob/master/examples/jib-multimodule/pom.xml)
